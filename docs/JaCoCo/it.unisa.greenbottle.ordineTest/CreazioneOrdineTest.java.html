<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="it">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/>
    <link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/>
    <title>CreazioneOrdineTest.java</title>
    <link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/>
    <script type="text/javascript" src="../jacoco-resources/prettify.js"></script>
</head>
<body onload="window['PR_TAB_WIDTH']=4;prettyPrint()">
<div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html"
                                                              class="el_session">Sessions</a></span><a
        href="../index.html" class="el_report">All in greenbottle Coverage Results</a> &gt; <a href="index.source.html"
                                                                                               class="el_package">it.unisa.greenbottle.ordineTest</a>
    &gt; <span class="el_source">CreazioneOrdineTest.java</span></div>
<h1>CreazioneOrdineTest.java</h1>
<pre class="source lang-java linenums">package it.unisa.greenbottle.ordineTest;

import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import it.unisa.greenbottle.controller.accessoControl.util.SessionCliente;
import it.unisa.greenbottle.controller.ordineControl.form.OrdineForm;
import it.unisa.greenbottle.controller.ordineControl.util.SessionCarrello;
import it.unisa.greenbottle.storage.accessoStorage.dao.ClienteDao;
import it.unisa.greenbottle.storage.accessoStorage.entity.Cliente;
import it.unisa.greenbottle.storage.areaPersonaleStorage.dao.IndirizzoDao;
import it.unisa.greenbottle.storage.areaPersonaleStorage.entity.Indirizzo;
import it.unisa.greenbottle.storage.catalogoStorage.dao.ProdottoDao;
import it.unisa.greenbottle.storage.catalogoStorage.entity.Categoria;
import it.unisa.greenbottle.storage.catalogoStorage.entity.Prodotto;
import it.unisa.greenbottle.storage.ordineStorage.dao.ComposizioneDao;
import it.unisa.greenbottle.storage.ordineStorage.dao.OrdineDao;
import it.unisa.greenbottle.storage.ordineStorage.entity.Ordine;
import java.util.HashMap;
import java.util.Map;
import java.util.Optional;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.bean.override.mockito.MockitoBean;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.ResultMatcher;

/**
 * Testa la funzionalit√† di creazione di un ordine.
 */
@AutoConfigureMockMvc
@SpringBootTest
<span class="fc" id="L37">public class CreazioneOrdineTest {</span>

  @Autowired
  private MockMvc mockMvc;

  @MockitoBean
  private OrdineForm ordineForm;

  @MockitoBean
  private SessionCarrello sessionCarrello;

  @MockitoBean
  private ProdottoDao prodottoDao;

  @MockitoBean
  private ClienteDao clienteDao;

  @MockitoBean
  private OrdineDao ordineDao;
  @MockitoBean
  private ComposizioneDao composizioneDao;

  @MockitoBean
  private SessionCliente sessionCliente;

  @MockitoBean
  private IndirizzoDao indirizzoDao;

  @Test
  public void nomeNonValido() throws Exception {
<span class="fc" id="L67">    testCreazioneOrdine(&quot;A1&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<span class="fc" id="L68">        Optional.of(&quot;asd&quot;),</span>
<span class="fc"
      id="L69">        status().isBadRequest(), &quot;Nome del titolare della carta non valido.&quot;);</span>
<span class="fc" id="L70">  }</span>

  @Test
  public void numeroNonValido() throws Exception {
<span class="fc" id="L74">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;00000000000000000&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<span class="fc" id="L75">        Optional.of(&quot;asd&quot;), status().isBadRequest(), &quot;Numero di carta non valido.&quot;);</span>
<span class="fc" id="L76">  }</span>

  @Test
  public void dataNonValido() throws Exception {
<span class="fc" id="L80">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;99/99&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<span class="fc" id="L81">        Optional.of(&quot;asd&quot;), status().isBadRequest(), &quot;Data di scadenza della carta non valida.&quot;);</span>
<span class="fc" id="L82">  }</span>

  @Test
  public void cvvNonValido() throws Exception {
<span class="fc" id="L86">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;ABC&quot;, &quot;1&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<span class="fc"
      id="L87">        Optional.of(&quot;&quot;), status().isBadRequest(), &quot;cvv non valido.&quot;);</span>
<span class="fc" id="L88">  }</span>

  @Test
  public void indirizzoNonValido() throws Exception {
<span class="fc" id="L92">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;-12&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<span class="fc" id="L93">        Optional.of(&quot;asd&quot;), status().isBadRequest(), &quot;Indirizzo non valido.&quot;);</span>
<span class="fc" id="L94">  }</span>

  @Test
  public void indirizzoNonPresente() throws Exception {
<span class="fc" id="L98">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;7355608&quot;, &quot;false&quot;,</span>
        &quot;false&quot;,
<span class="fc" id="L100">        Optional.of(&quot;&quot;), status().isNotFound(), &quot;Indirizzo non trovato.&quot;);</span>
<span class="fc" id="L101">  }</span>

  @Test
  public void isSupportoNonValido() throws Exception {
<span class="fc" id="L105">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;maybe&quot;,</span>
<span class="fc" id="L106">        Optional.of(&quot;Consegna al primo piano&quot;), status().isBadRequest(),</span>
        &quot;Errata selezione dell opzione di richiesta supporto aggiuntivo.&quot;);
<span class="fc" id="L108">  }</span>

  @Test
  public void isRitiroNonValido() throws Exception {
<span class="fc" id="L112">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;maybe&quot;, &quot;true&quot;,</span>
<span class="fc" id="L113">        Optional.of(&quot;Consegna al primo piano&quot;), status().isBadRequest(),</span>
        &quot;Errata selezione dell opzione di ritiro.&quot;);
<span class="fc" id="L115">  }</span>

  @Test
  public void descrizioneNonValida() throws Exception {
<span class="fc" id="L119">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;true&quot;,</span>
<span class="fc" id="L120">        Optional.of((&quot;a&quot;).repeat(320)), status().isBadRequest(),</span>
        &quot;Descrizione supporto troppo lunga.&quot;);
<span class="fc" id="L122">  }</span>

  @Test
  public void descrizioneNonPresente() throws Exception {
<span class="fc" id="L126">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;true&quot;,</span>
<span class="fc" id="L127">        Optional.of(&quot;&quot;), status().isBadRequest(), &quot;Descrizione supporto non inserita.&quot;);</span>
<span class="fc" id="L128">  }</span>

  @Test
  public void ordineSupportoValido() throws Exception {
<span class="fc" id="L132">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;true&quot;,</span>
<span class="fc"
      id="L133">        Optional.of(&quot;Consegna al primo piano&quot;), status().is3xxRedirection(), null);</span>
<span class="fc" id="L134">  }</span>

  @Test
  public void ordineValido() throws Exception {
<span class="fc" id="L138">    testCreazioneOrdine(&quot;Luigi Rossi&quot;, &quot;5032123166322313&quot;, &quot;02/26&quot;, &quot;123&quot;, &quot;1&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<span class="fc" id="L139">        Optional.of(&quot;&quot;), status().is3xxRedirection(), null);</span>
<span class="fc" id="L140">  }</span>

  @SuppressWarnings(&quot;OptionalUsedAsFieldOrParameterType&quot;)
  private void testCreazioneOrdine(String nomeTitolare, String numeroCarta, String dataScadenza,
                                   String cvv, String indirizz0, String isRitiro, String isSupporto,
                                   Optional&lt;String&gt; descrizioneSupporto,
                                   ResultMatcher resultmatcher,
                                   String expectedMessage)
      throws Exception {
<span class="fc" id="L149">    Cliente cliente = new Cliente();</span>

<span class="fc" id="L151">    clienteDao.save(cliente);</span>
<span class="fc" id="L152">    final Ordine ordine = new Ordine();</span>
<span class="fc" id="L153">    final Indirizzo indirizzo = new Indirizzo();</span>

<span class="fc" id="L155">    Categoria categoria = new Categoria(&quot;Bevande&quot;);</span>
<span class="fc" id="L156">    Prodotto prodotto1 = new Prodotto(</span>
        &quot;Prodotto1&quot;, &quot;Prodotto 1&quot;, null, 10.0f, 1000, categoria
    );
<span class="fc" id="L159">    Prodotto prodotto2 = new Prodotto(</span>
        &quot;Prodotto2&quot;, &quot;Prodotto 2&quot;, null, 5.0f, 1000, categoria
    );
<span class="fc" id="L162">    prodotto1.setId(1L);</span>
<span class="fc" id="L163">    prodotto2.setId(2L);</span>

<span class="fc"
      id="L165">    when(prodottoDao.findProdottoById(prodotto1.getId())).thenReturn(Optional.of(prodotto1));</span>
<span class="fc"
      id="L166">    when(prodottoDao.findProdottoById(prodotto2.getId())).thenReturn(Optional.of(prodotto2));</span>

<span class="fc" id="L168">    prodottoDao.save(prodotto1);</span>
<span class="fc" id="L169">    prodottoDao.save(prodotto2);</span>

<span class="fc" id="L171">    Long idIndirizzo = Long.valueOf(indirizz0);</span>

<span class="fc" id="L173">    Map&lt;Long, Integer&gt; carrello = new HashMap&lt;&gt;();</span>
<span class="fc" id="L174">    carrello.put(prodotto1.getId(), 10);</span>
<span class="fc" id="L175">    carrello.put(prodotto2.getId(), 50);</span>

<span class="fc" id="L177">    indirizzo.setId(idIndirizzo);</span>
<span class="fc"
      id="L178">    when(clienteDao.findClienteById(cliente.getId())).thenReturn(Optional.of(cliente));</span>
<span class="fc" id="L179">    when(sessionCliente.getCliente()).thenReturn(Optional.of(cliente));</span>
<span class="fc" id="L180">    when(sessionCarrello.getCarrello()).thenReturn(carrello);</span>
<span class="fc" id="L181">    when(indirizzoDao.findIndirizzoById(idIndirizzo)).thenReturn(</span>
<span class="fc bfc" id="L182" title="All 4 branches covered.">        idIndirizzo &gt; 0 &amp;&amp; idIndirizzo != 7355608 ? Optional.of(indirizzo) : Optional.empty());</span>
<span class="fc" id="L183">    when(ordineDao.save(ordine)).thenReturn(ordine);</span>


<span class="fc" id="L186">    mockMvc.perform(post(&quot;/ordina&quot;)</span>
<span class="fc" id="L187">            .param(&quot;nomeTitolare&quot;, nomeTitolare)</span>
<span class="fc" id="L188">            .param(&quot;numeroCarta&quot;, numeroCarta)</span>
<span class="fc" id="L189">            .param(&quot;dataScadenza&quot;, dataScadenza)</span>
<span class="fc" id="L190">            .param(&quot;cvv&quot;, cvv)</span>
<span class="fc" id="L191">            .param(&quot;indirizzo&quot;, indirizz0)</span>
<span class="fc" id="L192">            .param(&quot;isSupporto&quot;, isSupporto)</span>
<span class="fc" id="L193">            .param(&quot;isRitiro&quot;, isRitiro)</span>
<span class="fc"
      id="L194">            .param(&quot;descrizioneSupporto&quot;, descrizioneSupporto.orElse(&quot;&quot;))</span>
<span class="fc" id="L195">        ).andExpect(resultmatcher)</span>
<span class="fc" id="L196">        .andExpect(result -&gt; {</span>
<span class="fc bfc" id="L197" title="All 2 branches covered.">          if (expectedMessage != null) {</span>
<span class="fc" id="L198">            String errorMessage = result.getResponse().getErrorMessage();</span>
<span class="fc" id="L199">            assertTrue(errorMessage.contains(expectedMessage),</span>
                &quot;La risposta non contiene il messaggio atteso: &quot; + expectedMessage);
          }
<span class="fc" id="L202">        });</span>
<span class="fc" id="L203">  }</span>
}
</pre>
<div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span>
</div>
</body>
</html>