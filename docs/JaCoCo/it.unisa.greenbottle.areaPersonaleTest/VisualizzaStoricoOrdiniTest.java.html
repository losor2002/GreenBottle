<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="it">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/>
    <link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/>
    <title>VisualizzaStoricoOrdiniTest.java</title>
    <link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/>
    <script type="text/javascript" src="../jacoco-resources/prettify.js"></script>
</head>
<body onload="window['PR_TAB_WIDTH']=4;prettyPrint()">
<div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html"
                                                              class="el_session">Sessions</a></span><a
        href="../index.html" class="el_report">All in greenbottle Coverage Results</a> &gt; <a href="index.source.html"
                                                                                               class="el_package">it.unisa.greenbottle.areaPersonaleTest</a>
    &gt; <span class="el_source">VisualizzaStoricoOrdiniTest.java</span></div>
<h1>VisualizzaStoricoOrdiniTest.java</h1>
<pre class="source lang-java linenums">package it.unisa.greenbottle.areaPersonaleTest;

import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import it.unisa.greenbottle.controller.accessoControl.util.SessionCliente;
import it.unisa.greenbottle.storage.accessoStorage.entity.Cliente;
import it.unisa.greenbottle.storage.ordineStorage.dao.OrdineDao;
import it.unisa.greenbottle.storage.ordineStorage.entity.Ordine;
import java.sql.Timestamp;
import java.util.Optional;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.bean.override.mockito.MockitoBean;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.ResultMatcher;

/**
 * Testa la funzionalit√† di visualizzazione dello storico degli ordini.
 */
@SpringBootTest
@AutoConfigureMockMvc
<span class="fc" id="L28">public class VisualizzaStoricoOrdiniTest {</span>
  @Autowired
  private MockMvc mockMvc;

  @MockitoBean
  private SessionCliente sessionCliente;

  @MockitoBean
  private OrdineDao ordineDao;


  @Test
  public void startDateNonRispettaIlFormato() throws Exception {
<span class="fc" id="L41">    testVisualizzaStoricoOrdini(&quot;2024/01/01&quot;, &quot;2025-01-12&quot;, status().isBadRequest(),</span>
        &quot;Data di inizio non valida.&quot;);
<span class="fc" id="L43">  }</span>

  @Test
  public void endDateNonRispettaIlFormato() throws Exception {
<span class="fc" id="L47">    testVisualizzaStoricoOrdini(&quot;2024-01-12&quot;, &quot;2025/01/12&quot;, status().isBadRequest(),</span>
        &quot;Data di fine non valida.&quot;);
<span class="fc" id="L49">  }</span>

  @Test
  public void startDateDopoEndDate() throws Exception {
<span class="fc" id="L53">    testVisualizzaStoricoOrdini(&quot;2024-01-12&quot;, &quot;2024-01-11&quot;, status().isBadRequest(),</span>
        &quot;Data iniziale successiva alla data finale.&quot;);
<span class="fc" id="L55">  }</span>

  @Test
  public void dateRispettaIlFormato() throws Exception {
<span class="fc" id="L59">    testVisualizzaStoricoOrdini(&quot;2024-01-12&quot;, &quot;2025-01-12&quot;, status().isOk(), null);</span>
<span class="fc" id="L60">  }</span>

  private void testVisualizzaStoricoOrdini(String startDate, String endDate,
                                           ResultMatcher resultMatcher, String expectedMessage)
      throws Exception {
<span class="fc" id="L65">    Cliente cliente = new Cliente();</span>
<span class="fc" id="L66">    Ordine ordine =</span>
        new Ordine(12f, Ordine.StatoSpedizione.ELABORAZIONE, false, &quot;0000-0000-0000-0000&quot;,
<span class="fc"
      id="L68">            false, &quot;&quot;, new Timestamp(System.currentTimeMillis()), cliente, null);</span>

<span class="fc" id="L70">    when(ordineDao.findOrdineById(any())).thenReturn(Optional.of(ordine));</span>
<span class="fc" id="L71">    when(sessionCliente.getCliente()).thenReturn(Optional.of(cliente));</span>

<span class="fc" id="L73">    mockMvc.perform(get(&quot;/areaPersonale/visualizzaStoricoOrdini&quot;)</span>
<span class="fc" id="L74">            .param(&quot;startDate&quot;, startDate)</span>
<span class="fc" id="L75">            .param(&quot;endDate&quot;, endDate))</span>
<span class="fc" id="L76">        .andExpect(resultMatcher)</span>
<span class="fc" id="L77">        .andExpect(result -&gt; {</span>

<span class="fc bfc" id="L79" title="All 2 branches covered.">          if (expectedMessage != null) {</span>
<span class="fc" id="L80">            String errorMessage = result.getResponse().getErrorMessage();</span>
<span class="fc" id="L81">            assertTrue(errorMessage.contains(expectedMessage),</span>
                &quot;La risposta non contiene il messaggio atteso: &quot; + expectedMessage);
          }
<span class="fc" id="L84">        });</span>

<span class="fc" id="L86">  }</span>
}
</pre>
<div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span>
</div>
</body>
</html>