<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="it">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/>
    <link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/>
    <title>RegistrazioneTest.java</title>
    <link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/>
    <script type="text/javascript" src="../jacoco-resources/prettify.js"></script>
</head>
<body onload="window['PR_TAB_WIDTH']=4;prettyPrint()">
<div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html"
                                                              class="el_session">Sessions</a></span><a
        href="../index.html" class="el_report">All in greenbottle Coverage Results</a> &gt; <a href="index.source.html"
                                                                                               class="el_package">it.unisa.greenbottle.accessoTest</a>
    &gt; <span class="el_source">RegistrazioneTest.java</span></div>
<h1>RegistrazioneTest.java</h1>
<pre class="source lang-java linenums">package it.unisa.greenbottle.accessoTest;

import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import it.unisa.greenbottle.storage.accessoStorage.dao.ClienteDao;
import java.util.Optional;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.bean.override.mockito.MockitoBean;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.ResultMatcher;

/**
 * Test per la registrazione dei clienti.
 */
@SpringBootTest
@AutoConfigureMockMvc
<span class="fc" id="L23">public class RegistrazioneTest {</span>

  @Autowired
  private MockMvc mockMvc;

  @MockitoBean
  private ClienteDao clienteDao;

  @Test
  public void formatoNomeErrato() throws Exception {
<span class="fc" id="L33">    testRegistrazione(&quot;Gian@!@Carlo&quot;, &quot;Toronto&quot;, &quot;GiancarloToronto1966@gmail.com&quot;, &quot;GiancoToro66!&quot;,</span>
<span class="fc" id="L34">        status().isBadRequest(), &quot;Nome non rispetta il formato.&quot;);</span>
<span class="fc" id="L35">  }</span>

  @Test
  public void formatoCognomeErrato() throws Exception {
<span class="fc" id="L39">    testRegistrazione(&quot;Giancarlo&quot;, &quot;Toron@!@to&quot;, &quot;GiancarloToronto1966@gmail.com&quot;, &quot;GiancoToro66!&quot;,</span>
<span class="fc" id="L40">        status().isBadRequest(), &quot;Cognome non rispetta il formato.&quot;);</span>
<span class="fc" id="L41">  }</span>

  @Test
  public void emailTroppoLunga() throws Exception {
<span class="fc" id="L45">    testRegistrazione(&quot;Giancarlo&quot;, &quot;Toronto&quot;, &quot;a&quot;.repeat(320) + &quot;@gmail.com&quot;, &quot;GiancoToro66!&quot;,</span>
<span class="fc" id="L46">        status().isBadRequest(), &quot;Dimensione Email errata.&quot;);</span>
<span class="fc" id="L47">  }</span>

  @Test
  public void formatoEmailErrato() throws Exception {
<span class="fc" id="L51">    testRegistrazione(&quot;Giancarlo&quot;, &quot;Toronto&quot;, &quot;GiancarloToronto#1966@gmail.c&quot;, &quot;GiancoToro66!&quot;,</span>
<span class="fc" id="L52">        status().isBadRequest(), &quot;Formato Email errato.&quot;);</span>
<span class="fc" id="L53">  }</span>

  @Test
  public void formatoPasswordErrato() throws Exception {
<span class="fc" id="L57">    testRegistrazione(&quot;Giancarlo&quot;, &quot;Toronto&quot;, &quot;GiancarloToronto1966@gmail.com&quot;, &quot;ciao&quot;,</span>
<span class="fc" id="L58">        status().isBadRequest(), &quot;La Password deve contenere almeno una lettera minuscola, &quot;</span>
            + &quot;una maiuscola, un numero, &quot;
            + &quot;un carattere speciale ( @, #, $, %, ^, &amp;, +, =, !) &quot;
            + &quot;e avere una lunghezza minima di 8 caratteri.&quot;);
<span class="fc" id="L62">  }</span>

  @Test
  public void registrazioneEffettuata() throws Exception {
<span class="fc" id="L66">    when(clienteDao.findClienteByEmail(&quot;GiancarloToronto1966@example.com&quot;)).thenReturn(</span>
<span class="fc" id="L67">        Optional.empty());</span>

<span class="fc" id="L69">    testRegistrazione(&quot;Giancarlo&quot;, &quot;Toronto&quot;, &quot;GiancarloToronto1966@gmail.com&quot;, &quot;GiancoToro66!&quot;,</span>
<span class="fc" id="L70">        status().is3xxRedirection(), null);</span>
<span class="fc" id="L71">  }</span>

  /**
   * Funzione di supporto per eseguire test sulla registrazione.
   *
   * @param nome            Nome dell'utente
   * @param cognome         Cognome dell'utente
   * @param email           Email dell'utente
   * @param password        Password dell'utente
   * @param expectedStatus  Status HTTP atteso
   * @param expectedMessage Messaggio di errore atteso
   *                        nella risposta (null se non serve controllare)
   * @throws Exception In caso di errori durante il test
   */
  private void testRegistrazione(String nome, String cognome, String email, String password,
                                 ResultMatcher expectedStatus, String expectedMessage)
      throws Exception {
<span class="fc" id="L88">    mockMvc.perform(post(&quot;/registrazione&quot;)</span>
<span class="fc" id="L89">            .param(&quot;nome&quot;, nome)</span>
<span class="fc" id="L90">            .param(&quot;cognome&quot;, cognome)</span>
<span class="fc" id="L91">            .param(&quot;email&quot;, email)</span>
<span class="fc" id="L92">            .param(&quot;password&quot;, password))</span>
<span class="fc" id="L93">        .andExpect(expectedStatus)</span>
<span class="fc" id="L94">        .andExpect(result -&gt; {</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">          if (expectedMessage != null) {</span>
<span class="fc" id="L96">            String errorMessage = result.getResponse().getErrorMessage();</span>
<span class="fc" id="L97">            assertTrue(errorMessage.contains(expectedMessage),</span>
                &quot;La risposta non contiene il messaggio atteso: &quot; + expectedMessage);
          }
<span class="fc" id="L100">        });</span>
<span class="fc" id="L101">  }</span>
}
</pre>
<div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span>
</div>
</body>
</html>